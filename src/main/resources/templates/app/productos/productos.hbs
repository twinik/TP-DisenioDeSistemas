{{#partial "contenido"}}
    <div class="p-10 mx-auto max-w-7xl">
        <div class="mb-10">
            <h1 class="title1">Catálogo de productos</h1>
            {{#if puntosDisp}}
                <p class="text-xl text-black">
                    Puntos disponibles: <span class="font-bold text-black">{{formatPuntos puntosDisp.puntos}}</span>
                </p>
            {{/if}}
        </div>

        <div class="flex justify-between items-center mb-4">
            <form method="GET" action="" class="flex items-center" id="filtroForm">
                <label for="categoria" class="text-black font-bold mr-2">Filtrar por categoría:</label>
                <select id="categoria" name="categoria" class="py-2 px-3 rounded-lg text-black" onchange="filtrarCategoria();">
                    <option value="">Sin filtros</option>
                    <option value="GASTRONOMIA">Gastronomía</option>
                    <option value="ELECTRONICA">Electrónica</option>
                    <option value="ARTICULOS_HOGAR">Artículos para el Hogar</option>
                    <option value="OTROS">Otros</option>
                </select>
            </form>
        </div>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
            {{#each ofertas}}
                <div class="sidebar rounded-lg shadow-lg overflow-hidden flex flex-col h-full">
                    <img
                            class="w-full h-48 object-contain bg-white p-4"
                            src={{this.urlFoto}}
                            alt={{this.nombre}}
                    />
                    <div class="p-5 flex flex-col flex-grow">
                        <h5 class="text-2xl font-bold text-white mb-2">
                            {{this.nombre}}
                        </h5>
                        <p class="mb-3 text-lg text-gray-300">Samsung</p>
                        <p class="mb-4 text-xl font-bold text-white">
                            {{formatPuntos this.puntosNecesarios}} puntos
                        </p>
                        <div class="flex-grow"></div>
                        <form id="form-canje-{{this.id}}" action="/canjear-producto/{{this.id}}" method="post"
                              class="w-full mt-auto">
                            <button type="button"
                                    class="w-full py-2 px-4 boton-canje text-white font-bold rounded transition-colors duration-300"
                                    onclick="confirmarCanje('{{this.id}}', '{{this.nombre}}', '{{formatPuntos this.puntosNecesarios}}')">
                                Canjear
                            </button>
                        </form>
                    </div>
                </div>
            {{/each}}
        </div>
    </div>
{{/partial}}

{{#partial "scripts"}}
    <script>
        function confirmarCanje(productId, productName, productPoints) {
            swal({
                title: "¿Estás seguro?",
                text: "¿Deseas canjear " + productName + " por " + productPoints + " puntos?",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#28b463",
                cancelButtonColor: "#cb4335",
                confirmButtonText: "Sí, canjear",
                cancelButtonText: "No, cancelar",
                closeOnConfirm: false
            }, function (isConfirm) {
                if (isConfirm) {
                    document.getElementById('form-canje-' + productId).submit();
                }
            });
        }
    </script>
    <script>

        function guardarCategoriaSeleccionada() {
            const categoriaSeleccionada = document.getElementById('categoria').value;
            localStorage.setItem('categoriaSeleccionada', categoriaSeleccionada);
        }

        function cargarCategoriaSeleccionada() {
            const categoriaGuardada = localStorage.getItem('categoriaSeleccionada');
            if (categoriaGuardada && window.performance && window.performance.navigation.type !== 1) {
                document.getElementById('categoria').value = categoriaGuardada;
            } else {
                localStorage.removeItem('categoriaSeleccionada');
            }
        }

        function filtrarCategoria() {
            const categoria = document.getElementById('categoria').value;
            if (categoria === "") {
                localStorage.removeItem('categoriaSeleccionada');
                window.location.href = window.location.pathname;
            } else {
                guardarCategoriaSeleccionada();
                document.getElementById('filtroForm').submit();
            }
        }

        window.onload = cargarCategoriaSeleccionada;
    </script>
{{/partial}}

{{> templates/app/base}}